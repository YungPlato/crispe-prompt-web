<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Prompt Superior - AI Prompt Generator for Gemini</title>
    <meta name="description" content="Elevate your AI interactions with Prompt Superior. Our Gemini-powered tool helps you craft perfectly structured prompts using advanced frameworks for superior results in marketing, coding, and creative projects.">
    <meta name="keywords" content="AI prompt generator, prompt engineering, Gemini prompt helper, AI model personas, AI marketing prompts, AI coding prompts, creative AI prompts, SEO, prompt optimization, affiliate tools">
    <meta name="author" content="Prompt Superior">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.promptsuperior.com/">
    <meta property="og:title" content="Prompt Superior - AI Prompt Generator for Gemini">
    <meta property="og:description" content="Transform simple ideas into powerful, structured AI prompts. Get superior results from models like Gemini with our intelligent prompt engineering tool.">
    <!-- <meta property="og:image" content="https://www.promptsuperior.com/og-image.png"> -->

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://www.promptsuperior.com/">
    <meta property="twitter:title" content="Prompt Superior - AI Prompt Generator for Gemini">
    <meta property="twitter:description" content="Transform simple ideas into powerful, structured AI prompts. Get superior results from models like Gemini with our intelligent prompt engineering tool.">
    <!-- <meta property="twitter:image" content="https://www.promptsuperior.com/twitter-image.png"> -->

    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter & a more playful font for the new UI -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Custom styles for advanced animations */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000; /* Black background for Matrix effect */
            overflow-x: hidden;
        }
        
        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0; /* Behind content but visible */
        }

        main {
            position: relative;
            z-index: 10;
            transition: filter 0.5s ease-in-out; /* Smooth transition for color changes */
        }
        
        /* New UI styles with transparency */
        .magic-card {
            background-color: rgba(44, 26, 77, 0.85); /* Deep purple with transparency */
            backdrop-filter: blur(10px);
            font-family: 'Poppins', sans-serif;
        }

        .magic-title {
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.5), 0 0 12px rgba(192, 132, 252, 0.5);
        }

        /* Typing cursor effect for the output */
        .typing-effect::after {
            content: '▋';
            animation: blink 1s step-end infinite;
        }
        @keyframes blink {
            from, to { opacity: 1; }
            50% { opacity: 0; }
        }

        /* Styling for the accordion content for smooth transition */
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }

        /* CSS rule to ensure text wrapping in the output area */
        #promptOutput {
            white-space: pre-wrap;   /* Preserves whitespace and newlines, but wraps text */
            word-wrap: break-word;   /* Breaks long words to prevent overflow */
        }
    </style>
    
    <!-- JSON-LD Structured Data for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Prompt Superior",
      "operatingSystem": "Web",
      "applicationCategory": "DeveloperApplication",
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.9",
        "ratingCount": "88"
      },
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "description": "An AI-powered web application that helps users generate highly effective, structured prompts for large language models like Gemini using advanced prompt engineering techniques.",
      "featureList": [
        "AI-Powered Prompt Generation",
        "Advanced Prompt Structuring",
        "One-Click Copy to Clipboard",
        "Dynamic and Interactive UI",
        "Prompt Engineering Guides"
      ],
      "url": "https://www.promptsuperior.com/"
    }
    </script>

    <!-- Google AdSense Verification Code -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5449813703867320"
     crossorigin="anonymous"></script>
</head>
<body class="text-gray-200">

    <!-- Matrix Background Canvas -->
    <canvas id="bg-canvas"></canvas>

    <!-- Main Content Layout with Ad Placeholders -->
    <div class="flex items-center justify-center min-h-screen p-4">
        
        <!-- Left Skyscraper Ad (Visible on large screens) -->
        <aside class="hidden lg:block w-40 h-96 bg-slate-800/20 border border-slate-700/30 rounded-lg mr-8 flex items-center justify-center" aria-label="Advertisement">
            <span class="text-slate-500">Skyscraper Ad<br>160x600</span>
        </aside>

        <main class="w-full max-w-2xl mx-auto">
            <!-- New Magic UI Card -->
            <div id="main-card" class="magic-card p-8 rounded-3xl shadow-2xl shadow-purple-500/20 border border-purple-800">
                
                <!-- Header Section -->
                <header class="mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h1 class="magic-title text-3xl md:text-4xl font-bold text-white flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-lightbulb-fill mr-3 text-yellow-300" viewBox="0 0 16 16">
                            <path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13h-5a.5.5 0 0 1-.46-.302l-.761-1.77a1.964 1.964 0 0 0-.453-.618A5.984 5.984 0 0 1 2 6zm3 8.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1-.5-.5z"/>
                        </svg>
                        What do you want to create?
                        </h1>
                        <button id="themeToggle" class="bg-slate-800/60 hover:bg-slate-700 text-slate-200 px-3 py-2 rounded-lg text-xs border border-slate-600/60">Toggle Theme</button>
                    </div>
                </header>

                <!-- Input Section -->
                <section class="space-y-6" aria-labelledby="input-heading">
                    <h2 id="input-heading" class="sr-only">Prompt Input</h2>
                    <textarea id="userInput" rows="2" class="w-full bg-white border-2 border-gray-300 rounded-xl p-4 text-lg text-gray-700 focus:ring-4 focus:ring-purple-400 focus:border-purple-500 transition duration-200 placeholder-gray-400 shadow-inner" placeholder="e.g., A social media campaign for a new sneaker launch"></textarea>
                    <div class="grid gap-4 md:grid-cols-2">
                        <div>
                            <label for="frameworkSelect" class="block text-sm text-slate-200 mb-1">Framework</label>
                            <select id="frameworkSelect" class="w-full bg-white border-2 border-gray-300 rounded-xl p-3 text-gray-700 focus:ring-4 focus:ring-purple-400 focus:border-purple-500">
                                <option value="CRISPE">CRISPE (Context, Role, Intent, Style, Persona, Extras)</option>
                                <option value="AIDA">AIDA (Attention, Interest, Desire, Action)</option>
                                <option value="PAS">PAS (Problem, Agitation, Solution)</option>
                            </select>
                        </div>
                        <div>
                            <label for="toneSelect" class="block text-sm text-slate-200 mb-1">Tone</label>
                            <select id="toneSelect" class="w-full bg-white border-2 border-gray-300 rounded-xl p-3 text-gray-700 focus:ring-4 focus:ring-purple-400 focus:border-purple-500">
                                <option value="Neutral" selected>Neutral</option>
                                <option value="Friendly">Friendly</option>
                                <option value="Professional">Professional</option>
                                <option value="Persuasive">Persuasive</option>
                                <option value="Playful">Playful</option>
                            </select>
                        </div>
                        <div>
                            <label for="lengthSelect" class="block text-sm text-slate-200 mb-1">Length</label>
                            <select id="lengthSelect" class="w-full bg-white border-2 border-gray-300 rounded-xl p-3 text-gray-700 focus:ring-4 focus:ring-purple-400 focus:border-purple-500">
                                <option value="short">Short (~200 words)</option>
                                <option value="medium" selected>Medium (~500 words)</option>
                                <option value="long">Long (~1000+ words)</option>
                            </select>
                        </div>
                        <div>
                            <label for="creativitySlider" class="block text-sm text-slate-200 mb-1">Creativity (temperature): <span id="creativityValue">0.7</span></label>
                            <input id="creativitySlider" type="range" min="0.1" max="1" step="0.1" value="0.7" class="w-full accent-purple-500">
                        </div>
                        <div class="md:col-span-2">
                            <label for="personaInput" class="block text-sm text-slate-200 mb-1">Persona (optional)</label>
                            <input id="personaInput" type="text" placeholder="e.g., Senior copywriter in tech, Growth marketer, Data-driven strategist" class="w-full bg-white border-2 border-gray-300 rounded-xl p-3 text-gray-700 focus:ring-4 focus:ring-purple-400 focus:border-purple-500" />
                        </div>
                    </div>
                    <button id="generateBtn" class="w-full bg-gradient-to-br from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-bold text-2xl py-4 px-4 rounded-xl transition-all duration-300 shadow-lg hover:shadow-purple-500/50 flex items-center justify-center transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">
                        <span id="btn-text">Generate Magic ✨</span>
                        <svg id="btn-loader" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </button>
                </section>
                
                <!-- History Section -->
                <section id="historySection" class="mt-6" aria-labelledby="history-heading">
                    <div class="flex items-center justify-between mb-2">
                        <h2 id="history-heading" class="text-sm font-semibold text-slate-200">History</h2>
                        <button id="clearHistoryBtn" class="text-xs text-slate-300 hover:text-white underline">Clear</button>
                    </div>
                    <ul id="historyList" class="space-y-2"></ul>
                </section>

                <!-- Output Section and Toolbar -->
                <section id="outputContainer" class="mt-8 hidden" aria-labelledby="output-heading">
                    <h2 id="output-heading" class="text-xl font-semibold text-white mb-3">Your Generated Prompt:</h2>
                    <div class="flex items-center gap-2 mb-2">
                        <button id="regenerateBtn" class="bg-purple-700 hover:bg-purple-600 text-white text-xs px-3 py-2 rounded-md">Regenerate</button>
                        <button id="exportMdBtn" class="bg-slate-800/70 hover:bg-slate-700 text-slate-200 text-xs px-3 py-2 rounded-md border border-slate-600/60">Export .md</button>
                        <button id="exportJsonBtn" class="bg-slate-800/70 hover:bg-slate-700 text-slate-200 text-xs px-3 py-2 rounded-md border border-slate-600/60">Export .json</button>
                    </div>
                    <div class="bg-purple-900/50 border border-purple-700 rounded-lg p-4 relative min-h-[150px]">
                        <pre id="promptOutput" class="text-purple-200 text-sm leading-relaxed font-sans"></pre>
                        <button id="copyBtn" class="absolute top-2 right-2 bg-purple-700 hover:bg-purple-600 text-purple-200 font-semibold py-1 px-3 rounded-md text-xs transition duration-200 opacity-0">
                            Copy
                        </button>
                    </div>
                </section>
            </div>

            <!-- Accordion Info Section -->
            <section class="w-full max-w-2xl mx-auto mt-8 space-y-4">
                 <!-- Accordion 1: Our Mission -->
                 <div class="bg-black/80 backdrop-blur-sm border border-slate-700/50 p-px rounded-xl">
                    <div class="bg-slate-900/80 rounded-[11px]">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 text-left">
                            <h3 class="text-lg font-semibold text-slate-200">Our Mission: AI for Everyone</h3>
                            <svg class="accordion-icon w-6 h-6 text-slate-400 transition-transform transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content px-4 pb-4">
                            <div class="border-t border-slate-700 pt-4 text-slate-300 space-y-4 text-sm">
                                <div>
                                    <h4 class="font-semibold text-white mb-2">Why Prompting Matters</h4>
                                    <p>Think of an AI model as a powerful engine. Your prompt is the steering wheel. Without clear directions, even the strongest engine can't get you where you want to go. Learning to "speak AI" through effective prompting saves you time, reduces frustration, and unlocks results you never thought possible. A great prompt is the difference between a generic answer and a game-changing solution.</p>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-white mb-2">Making AI Easier</h4>
                                    <p>Our mission at Prompt Superior is to be the universal translator between human ideas and artificial intelligence. We believe everyone—creators, entrepreneurs, students, and professionals—should be able to leverage the power of AI without needing a technical background. This tool is designed to bridge that gap, turning your simple goals into the structured language AI understands best, empowering you to create, innovate, and solve problems faster than ever before.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Accordion 2: Mastering Prompt Engineering -->
                 <div class="bg-black/80 backdrop-blur-sm border border-slate-700/50 p-px rounded-xl">
                    <div class="bg-slate-900/80 rounded-[11px]">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 text-left">
                            <h3 class="text-lg font-semibold text-slate-200">Mastering Prompt Engineering</h3>
                            <svg class="accordion-icon w-6 h-6 text-slate-400 transition-transform transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content px-4 pb-4">
                            <div class="border-t border-slate-700 pt-4 text-slate-300 space-y-4 text-sm">
                                <p><strong>1. Be Specific & Clear:</strong> The more detail you provide, the better the result. Instead of "write about cars," try "write a blog post comparing the fuel efficiency of 2025 hybrid SUVs."</p>
                                <p><strong>2. Define the Role & Persona:</strong> Tell the AI who to be (e.g., "Act as a senior copywriter") and what personality to have ("Your tone is witty and engaging"). This sets the expertise and voice.</p>
                                <p><strong>3. Provide Context & Examples:</strong> Give the AI background information and show it what you want. Instead of 'write in a friendly tone,' provide an example: 'Write in a friendly tone, like this: Hey there! Ready to dive into...'"</p>
                                <p><strong>4. Specify the Format:</strong> Ask for exactly what you want. Do you need a bulleted list, a table, a JSON object, or a formal essay? Clearly state the desired structure.</p>
                                <p><strong>5. Use Chain-of-Thought:</strong> For complex problems, ask the AI to "think step-by-step." Instructing it to "break down the problem and explain its reasoning before giving the final answer" often leads to more accurate results.</p>
                                <p><strong>6. Use Negative Prompts:</strong> Tell the AI what to avoid. For instance, add constraints like "Do not use technical jargon," "The response should be under 200 words," or "Avoid clichés about teamwork."</p>
                                <p><strong>7. Iterate and Refine:</strong> Your first prompt is a starting point. If the result isn't perfect, don't give up. Add more detail, clarify an instruction, or refine your examples and try again. The best prompts are often built through iteration.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Accordion 3: AI Model Personas to Try -->
                <div class="bg-black/80 backdrop-blur-sm border border-slate-700/50 p-px rounded-xl">
                    <div class="bg-slate-900/80 rounded-[11px]">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 text-left">
                            <h3 class="text-lg font-semibold text-slate-200">AI Model Personas to Try</h3>
                            <svg class="accordion-icon w-6 h-6 text-slate-400 transition-transform transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content px-4 pb-4">
                            <div class="border-t border-slate-700 pt-4 text-slate-300 space-y-3 text-sm">
                                <p>Inject creativity into your results by assigning the AI a unique persona. Try starting your prompt with "Act as a..."</p>
                                <ul class="list-disc list-inside space-y-2">
                                    <li><strong>The Skeptic:</strong> "Act as a skeptical journalist. Question my assumptions and point out potential flaws in my plan."</li>
                                    <li><strong>The Enthusiastic Mentor:</strong> "Act as an encouraging mentor. Provide supportive feedback and actionable steps for improvement."</li>
                                    <li><strong>The Devil's Advocate:</strong> "Act as a devil's advocate. Argue against my main points to help me strengthen my position."</li>
                                    <li><strong>The Historian:</strong> "Act as a historian from the year 2100 looking back at this topic. Provide a future perspective."</li>
                                    <li><strong>The Stand-up Comedian:</strong> "Act as a stand-up comedian. Explain this complex topic using humor and relatable analogies."</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                 <!-- Accordion 4: Recommended Tools (Affiliate) -->
                <div class="bg-black/80 backdrop-blur-sm border border-slate-700/50 p-px rounded-xl">
                    <div class="bg-slate-900/80 rounded-[11px]">
                        <button class="accordion-toggle w-full flex justify-between items-center p-4 text-left">
                            <h3 class="text-lg font-semibold text-slate-200">Recommended Tools</h3>
                            <svg class="accordion-icon w-6 h-6 text-slate-400 transition-transform transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content px-4 pb-4">
                            <div class="border-t border-slate-700 pt-4 text-slate-300 space-y-4 text-sm">
                                <p>Take your AI creations to the next level with these powerful tools:</p>
                                <div>
                                    <h4 class="font-semibold">AI Writing Assistants</h4>
                                    <a href="https://koala.sh/?via=promptsuperior" target="_blank" rel="noopener noreferrer" class="text-purple-400 hover:underline">Koala AI</a> - A powerful tool for creating SEO-optimized articles and blog posts with one click.
                                    <p class="text-xs text-slate-400 mt-1">Use code <strong class="text-white">D9MAXVXZ</strong> for 15% off all payments.</p>
                                </div>
                                <div>
                                    <h4 class="font-semibold">Custom AI Chatbots</h4>
                                    <a href="https://customgpt.ai/?fpr=promptsuperior" target="_blank" rel="noopener noreferrer" class="text-purple-400 hover:underline">CustomGPT.ai</a> - Build a custom chatbot for your website using your own business content.
                                </div>
                                <div>
                                    <h4 class="font-semibold">AI Image Generators</h4>
                                    <a href="#" class="text-purple-400 hover:underline">Midjourney</a> - The best platform for creating stunning, artistic, and photorealistic images from text prompts.
                                </div>
                                <div>
                                    <h4 class="font-semibold">Prompt Engineering Courses</h4>
                                    <a href="#" class="text-purple-400 hover:underline">Coursera - Prompt Engineering Specialization</a> - A comprehensive course from Vanderbilt University to truly master the craft.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Bottom Banner Ad -->
            <footer class="w-full max-w-2xl mx-auto mt-8 text-center" role="contentinfo">
                <div class="h-24 bg-slate-800/20 border border-slate-700/30 rounded-lg flex items-center justify-center">
                    <span class="text-slate-500">Banner Ad - 728x90</span>
                </div>
                <p class="text-xs text-slate-600 mt-4">Affiliate Disclosure: This site may contain affiliate links. If you make a purchase through these links, we may earn a commission at no extra cost to you.</p>
            </footer>
        </main>

        <!-- Right Skyscraper Ad (Visible on large screens) -->
        <aside class="hidden lg:block w-40 h-96 bg-slate-800/20 border border-slate-700/30 rounded-lg ml-8 flex items-center justify-center" aria-label="Advertisement">
            <span class="text-slate-500">Skyscraper Ad<br>160x600</span>
        </aside>

    </div>

    <script>
        // --- Main Application Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const generateBtn = document.getElementById('generateBtn');
            const btnText = document.getElementById('btn-text');
            const btnLoader = document.getElementById('btn-loader');
            const userInput = document.getElementById('userInput');
            const frameworkSelect = document.getElementById('frameworkSelect');
            const toneSelect = document.getElementById('toneSelect');
            const lengthSelect = document.getElementById('lengthSelect');
            const creativitySlider = document.getElementById('creativitySlider');
            const creativityValue = document.getElementById('creativityValue');
            const personaInput = document.getElementById('personaInput');
            const outputContainer = document.getElementById('outputContainer');
            const promptOutput = document.getElementById('promptOutput');
            const copyBtn = document.getElementById('copyBtn');
            const historyList = document.getElementById('historyList');
            const clearHistoryBtn = document.getElementById('clearHistoryBtn');
            const accordionToggles = document.querySelectorAll('.accordion-toggle');
            const themeToggle = document.getElementById('themeToggle');
            const exportMdBtn = document.getElementById('exportMdBtn');
            const exportJsonBtn = document.getElementById('exportJsonBtn');
            const regenerateBtn = document.getElementById('regenerateBtn');

            // --- Typing Effect Function ---
            function typeEffect(element, text, callback) {
                let i = 0;
                element.innerHTML = "";
                element.classList.add('typing-effect');
                const timer = setInterval(() => {
                    if (i < text.length) {
                        element.textContent += text.charAt(i);
                        i++;
                    } else {
                        clearInterval(timer);
                        element.classList.remove('typing-effect');
                        if (callback) callback();
                    }
                }, 15);
            }

            // --- History Helpers ---
            function loadHistory() {
                try {
                    const raw = localStorage.getItem('ps_history');
                    return raw ? JSON.parse(raw) : [];
                } catch { return []; }
            }
            function saveHistory(items) {
                localStorage.setItem('ps_history', JSON.stringify(items.slice(0, 20)));
            }
            function renderHistory() {
                const items = loadHistory();
                historyList.innerHTML = '';
                items.forEach((item, idx) => {
                    const li = document.createElement('li');
                    li.className = 'bg-slate-900/60 border border-slate-700/50 rounded-lg p-3 text-xs flex justify-between items-start gap-2';
                    const text = document.createElement('div');
                    text.className = 'text-slate-300 line-clamp-2 break-words';
                    text.textContent = item.prompt;
                    const right = document.createElement('div');
                    right.className = 'flex items-center gap-2';
                    const copy = document.createElement('button');
                    copy.className = 'text-slate-300 hover:text-white underline';
                    copy.textContent = 'Copy';
                    copy.addEventListener('click', () => navigator.clipboard.writeText(item.prompt));
                    const replay = document.createElement('button');
                    replay.className = 'text-slate-300 hover:text-white underline';
                    replay.textContent = 'Replay';
                    replay.addEventListener('click', async () => {
                        userInput.value = item.userRequest;
                        frameworkSelect.value = item.framework;
                        toneSelect.value = item.tone;
                        lengthSelect.value = item.length;
                        creativitySlider.value = item.temperature;
                        creativityValue.textContent = item.temperature;
                        personaInput.value = item.persona || '';
                        generateBtn.click();
                    });
                    right.appendChild(copy);
                    right.appendChild(replay);
                    li.appendChild(text);
                    li.appendChild(right);
                    historyList.appendChild(li);
                });
            }
            renderHistory();
            clearHistoryBtn.addEventListener('click', () => { saveHistory([]); renderHistory(); });

            creativitySlider.addEventListener('input', () => { creativityValue.textContent = creativitySlider.value; });

            // --- Set Loading State ---
            function setLoading(isLoading) {
                if (isLoading) {
                    generateBtn.disabled = true;
                    btnText.innerHTML = 'Generating...';
                    btnLoader.classList.remove('hidden');
                } else {
                    generateBtn.disabled = false;
                    btnText.innerHTML = 'Generate Magic ✨';
                    btnLoader.classList.add('hidden');
                }
            }

            // --- Theme Toggle ---
            function applyTheme(theme) {
                const body = document.body;
                if (theme === 'light') {
                    body.classList.add('bg-white');
                    body.classList.remove('text-gray-200');
                    document.getElementById('main-card').classList.remove('magic-card');
                    document.getElementById('main-card').classList.add('bg-white');
                } else {
                    body.classList.remove('bg-white');
                    body.classList.add('text-gray-200');
                    document.getElementById('main-card').classList.add('magic-card');
                }
            }
            function initTheme() {
                const saved = localStorage.getItem('ps_theme') || 'dark';
                applyTheme(saved);
                themeToggle.textContent = saved === 'light' ? 'Use Dark' : 'Use Light';
            }
            themeToggle.addEventListener('click', () => {
                const current = localStorage.getItem('ps_theme') || 'dark';
                const next = current === 'light' ? 'dark' : 'light';
                localStorage.setItem('ps_theme', next);
                applyTheme(next);
                themeToggle.textContent = next === 'light' ? 'Use Dark' : 'Use Light';
            });
            initTheme();

            // --- Gemini API Call Function (via backend proxy) ---
            async function callGemini(userRequest, retries = 3, delay = 1000) {
                const framework = frameworkSelect.value;
                const tone = toneSelect.value;
                const length = lengthSelect.value;
                const temperature = parseFloat(creativitySlider.value);
                const persona = personaInput.value.trim();

                const builder = {
                    CRISPE: () => {
                        return `You are a prompt engineering expert. Your task is to take a user's simple request and structure it into a detailed and effective prompt using the C.R.I.S.P.E. framework. Use the user's request as the Intent (I). The tone should be ${tone}. ` +
                        (persona ? `Adopt this persona: ${persona}. ` : '') +
                        `Target length: ${length}. Your final output must be ONLY the formatted prompt, following this exact structure: C (Context): [Generated Context]\n\nR (Role): [Generated Role]\n\nI (Intent): ${userRequest}\n\nS (Style): [Generated Style]\n\nP (Persona): [Generated Persona]\n\nE (Extras): [Generated Extras]`;
                    },
                    AIDA: () => {
                        return `You are a prompt engineering expert. Rewrite the user's request into an AIDA prompt with the tone ${tone}. ` +
                        (persona ? `Adopt this persona: ${persona}. ` : '') +
                        `Target length: ${length}. Output ONLY this structure: Attention: ...\n\nInterest: ...\n\nDesire: ...\n\nAction: ...\n\nUser Intent: ${userRequest}`;
                    },
                    PAS: () => {
                        return `You are a prompt engineering expert. Rewrite the user's request into a PAS prompt with the tone ${tone}. ` +
                        (persona ? `Adopt this persona: ${persona}. ` : '') +
                        `Target length: ${length}. Output ONLY this structure: Problem: ...\n\nAgitation: ...\n\nSolution: ...\n\nUser Intent: ${userRequest}`;
                    }
                };
                const metaPrompt = (builder[framework] || builder['CRISPE'])();
                const generationConfig = { temperature };
                const payload = { contents: [{ role: "user", parts: [{ text: metaPrompt }] }], generationConfig };
                const apiUrl = "/api/generate";
                try {
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    
                    if (!response.ok) {
                        const errorBody = await response.json();
                        const errorMessage = errorBody?.error?.message || `HTTP error! status: ${response.status}`;
                        throw new Error(errorMessage);
                    }

                    const result = await response.json();
                    if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                        return result.candidates[0].content.parts[0].text;
                    } else if (result.promptFeedback && result.promptFeedback.blockReason) {
                        // Handle cases where the prompt was blocked
                        return `Error: Prompt was blocked. Reason: ${result.promptFeedback.blockReason}. Please modify your request.`;
                    }
                    else {
                        throw new Error("Invalid response structure from Gemini API.");
                    }
                } catch (error) {
                    console.error(`API call failed: ${error.message}`);
                    if (retries > 0) {
                        await new Promise(res => setTimeout(res, delay));
                        return callGemini(userRequest, retries - 1, delay * 2);
                    } else {
                        return `Error: ${error.message}\n\nUnable to generate prompt. This may be due to API limits or a network issue. Please try again later.`;
                    }
                }
            }

            // --- Event Listeners ---
            generateBtn.addEventListener('click', async () => {
                const userRequest = userInput.value.trim();
                if (!userRequest) return;
                setLoading(true);
                outputContainer.classList.remove('hidden');
                copyBtn.classList.add('opacity-0');
                promptOutput.textContent = "";
                const generatedText = await callGemini(userRequest);
                typeEffect(promptOutput, generatedText.trim(), () => {
                    copyBtn.classList.remove('opacity-0');
                    copyBtn.classList.add('transition-opacity', 'duration-500');
                });
                setLoading(false);
                // Save to history
                const items = loadHistory();
                items.unshift({
                    userRequest,
                    prompt: promptOutput.textContent,
                    framework: frameworkSelect.value,
                    tone: toneSelect.value,
                    length: lengthSelect.value,
                    temperature: creativitySlider.value,
                    persona: personaInput.value.trim(),
                    ts: Date.now()
                });
                saveHistory(items);
                renderHistory();
            });
            regenerateBtn.addEventListener('click', async () => {
                const userRequest = userInput.value.trim();
                if (!userRequest) return;
                setLoading(true);
                const generatedText = await callGemini(userRequest);
                promptOutput.textContent = generatedText.trim();
                copyBtn.classList.remove('opacity-0');
                setLoading(false);
            });
            function download(filename, content, mime) {
                const a = document.createElement('a');
                const blob = new Blob([content], { type: mime });
                a.href = URL.createObjectURL(blob);
                a.download = filename;
                a.click();
                URL.revokeObjectURL(a.href);
            }
            exportMdBtn.addEventListener('click', () => {
                const text = promptOutput.textContent || '';
                if (!text) return;
                download('prompt.md', `# Generated Prompt\n\n${text}\n`, 'text/markdown');
            });
            exportJsonBtn.addEventListener('click', () => {
                const text = promptOutput.textContent || '';
                if (!text) return;
                const data = {
                    prompt: text,
                    meta: {
                        framework: frameworkSelect.value,
                        tone: toneSelect.value,
                        length: lengthSelect.value,
                        temperature: parseFloat(creativitySlider.value),
                        persona: personaInput.value.trim()
                    }
                };
                download('prompt.json', JSON.stringify(data, null, 2), 'application/json');
            });
            
            copyBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(promptOutput.textContent).then(() => {
                    copyBtn.textContent = 'Copied!';
                    setTimeout(() => { copyBtn.textContent = 'Copy'; }, 2000);
                }).catch(err => console.error('Failed to copy: ', err));
            });

            accordionToggles.forEach(toggle => {
                toggle.addEventListener('click', () => {
                    const content = toggle.nextElementSibling;
                    const icon = toggle.querySelector('.accordion-icon');
                    const isExpanded = content.style.maxHeight;

                    if (isExpanded && isExpanded !== '0px') {
                        content.style.maxHeight = '0px';
                        icon.classList.remove('rotate-180');
                    } else {
                        content.style.maxHeight = content.scrollHeight + 'px';
                        icon.classList.add('rotate-180');
                    }
                });
            });
        });

        // --- Matrix Background Logic with Color Cycling ---
        function initMatrix() {
            const canvas = document.querySelector('#bg-canvas');
            const mainContent = document.querySelector('main');
            const ctx = canvas.getContext('2d');

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const alphabet = 'アァカサタナハマヤャラワガザダバパイィキシチニヒミリヰギジヂビピウゥクスツヌフムユュルグズブヅプエェケセテネヘメレヱゲゼデベペオォコソトノホモヨョロヲゴゾドボポヴッンABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            const fontSize = 16;
            const columns = canvas.width / fontSize;
            const rainDrops = [];
            for (let x = 0; x < columns; x++) rainDrops[x] = 1;

            let hue = 270; // Start with purple

            const mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');
            const draw = () => {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
                ctx.font = fontSize + 'px monospace';

                for (let i = 0; i < rainDrops.length; i++) {
                    const text = alphabet.charAt(Math.floor(Math.random() * alphabet.length));
                    ctx.fillText(text, i * fontSize, rainDrops[i] * fontSize);
                    if (rainDrops[i] * fontSize > canvas.height && Math.random() > 0.975) rainDrops[i] = 0;
                    rainDrops[i]++;
                }
                
                hue = (hue + 0.1) % 360;
                mainContent.style.filter = `hue-rotate(${hue - 270}deg)`;
            };

            let intervalId = null;
            function start() {
                if (intervalId) return;
                intervalId = setInterval(draw, 50); // slightly lower FPS for perf
            }
            function stop() {
                if (!intervalId) return;
                clearInterval(intervalId);
                intervalId = null;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }

            if (mediaQuery.matches) {
                stop();
            } else {
                start();
            }
            mediaQuery.addEventListener('change', (e) => { e.matches ? stop() : start(); });

            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        }
        
        initMatrix();
    </script>
</body>
</html>
